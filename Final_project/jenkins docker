pipeline {
    agent any 
    stages {
        stage('Iac docker') { 
            steps {
                sh 'cd /home/vagrant/docker_inv ; terraform apply -auto-approve'
                sh 'IPADD=$(az vm show -d -g resorf -n "docker"  --query publicIps -o tsv); printf "[docker]\n$IPADD" > /home/vagrant/ansible/host'
            }
        }
        stage('docker ans') { 
            steps {
                  sh 'id'
                  sh 'cat /home/vagrant/ansible/host'
                  sh 'ansible-playbook /home/vagrant/ansible/docker.yml -i /home/vagrant/ansible/host -b' 
                  //sh 'rm /home/vagrant/ansible/host'
                
            }
        }
        
